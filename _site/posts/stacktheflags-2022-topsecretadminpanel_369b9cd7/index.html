<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GovTech Stack the Flags CTF 2022 - Top Secret Admin Panel</title>
  <meta name="description" content="The challenge starts by providing us with a APK file, in which I immediately installed it onto my Genymotion Android VM Emulator (just use the free edition w...">
  
  <link rel="stylesheet" href="/assets/css/main.css">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="terminal-container">
  <!-- Left Pane: ls-style post listing -->
  <aside class="pane pane-left">
    <div class="pane-header">
      <span class="prompt">~/posts$</span> ls -la
    </div>
    <div class="pane-subheader">
      <input type="text" id="category-filter" placeholder="filter by category or filename..." autocomplete="off">
    </div>
    <div class="pane-content">
      <div class="ls-output">
        <div class="ls-line ls-header">total 14</div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/sparksim_red_vs_blue_platform_9decf35e/" data-categories="research,red-team,blue-team,ctf,education">
          <div class="ls-row-1">
            <span class="ls-name">9decf35e.md</span>
            <span class="ls-size">2714w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Feb 04</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">research</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/old_skool_atkdef_251292cc/" data-categories="projects,attkdef-ctf">
          <div class="ls-row-1">
            <span class="ls-name">251292cc.md</span>
            <span class="ls-size">3241w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Mar 21</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">projects</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/kernel_expdev_setup_with_vscode_ee35e20e/" data-categories="vr,kernelpwn,pwn">
          <div class="ls-row-1">
            <span class="ls-name">ee35e20e.md</span>
            <span class="ls-size">2200w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Mar 04</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">vr</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/mcrta_review_writeup_3ee1dbfe/" data-categories="certs,mcrta">
          <div class="ls-row-1">
            <span class="ls-name">3ee1dbfe.md</span>
            <span class="ls-size">1189w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Jan 12</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">certs</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/crtp_review_writeup_98ab231c/" data-categories="certs,crtp">
          <div class="ls-row-1">
            <span class="ls-name">98ab231c.md</span>
            <span class="ls-size">1307w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Nov 03</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">certs</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_8_fc50222e/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">fc50222e.md</span>
            <span class="ls-size">1709w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 21</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_7a_fa086321/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">fa086321.md</span>
            <span class="ls-size">1149w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 20</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_6a_f360496c/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">f360496c.md</span>
            <span class="ls-size">1351w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 19</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_5_c8ec6a29/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">c8ec6a29.md</span>
            <span class="ls-size">1305w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 18</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_4_9c752a2b/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">9c752a2b.md</span>
            <span class="ls-size">1077w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 17</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_3_8ab5e6e3/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">8ab5e6e3.md</span>
            <span class="ls-size">642w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 16</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_2_6cc9934c/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">6cc9934c.md</span>
            <span class="ls-size">792w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 15</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_1_471f6270/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">471f6270.md</span>
            <span class="ls-size">685w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 14</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item active" data-post="/posts/stacktheflags-2022-topsecretadminpanel_369b9cd7/" data-categories="ctf">
          <div class="ls-row-1">
            <span class="ls-name">369b9cd7.md</span>
            <span class="ls-size">861w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Dec 10</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
      </div>
    </div>
  </aside>

  <!-- Center Pane: Post content -->
  <main class="pane pane-center">
    <div class="pane-header">
      <span class="prompt">~/</span>
      <span id="center-path">GovTech Stack the Flags CTF 2022 - To...</span>
    </div>
    <div class="pane-content">
      <div class="post-viewer active">
        <article class="post-content">
          <header class="post-header">
            <h1>GovTech Stack the Flags CTF 2022 - Top Secret Admin Panel</h1>
            <div class="post-meta">
              <span class="post-date">December 10, 2022</span>
              
              <span class="post-categories">
                
                  <span class="category">ctf</span>
                
              </span>
              
            </div>
          </header>
          
          <div class="post-body">
            <p>The challenge starts by providing us with a APK file, in which I immediately installed it onto my Genymotion Android VM Emulator (just use the free edition will do) with the adb tool. Upon loading the app, it presents itself with a login interface, prompting me to key in the username and password:</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo1.png" alt="" /></p>

<p>Next, as part of my mobile app testing framework, I will decompile the mobile app using two tools:</p>
<ul>
  <li>apktool (android decompilation to smali code)</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apktool d challenge.apk
</code></pre></div></div>

<ul>
  <li>jadx (decompile to smali code and map it to Java code)</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jadx <span class="nt">-d</span> <span class="si">$(</span>PWD<span class="si">)</span>/jadx-output challenge.apk
</code></pre></div></div>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo3.png" alt="" /></p>

<p>I’d like to take this opportunity to say something to the challenge developer:</p>

<p>Thank you for NOT obfuscating the APK file.</p>

<p>It was honestly brutal when I had to go through obfuscated apps over my years as a security consultant.</p>

<p>As we were presented with a login page, the first instinctive thing to do is to figure out the login functionality and how it works. A quick grep of the login keyword within the jadx output and it directs the user to this file (put filename here):</p>

<p><img src="assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo4.png" alt="" /></p>

<p>First thing that came up to my mind was: “what the hell is Amplify”? A quick Google search and what I got was this:</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo17.png" alt="" /></p>

<p>OOOOOOO~~~ So it’s actually a backend framework for mobile/web applications, and it’s powered by Amazon Web Services. :D</p>

<p>Not gonna lie, ever since I left consultancy and went to teaching, I have never come across mobile apps that leverage on AWS Identity Access Management as the backbone of user authentication. So this would definitely be a first time for me.</p>

<p>The login mechanism relies heavily on AWS, and this can be seen by the captured web traffic via Burp Suite when attempting to log in with bogus credentials:</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo6.png" alt="" /></p>

<p>From here it was pretty much a dead end when I can’t proceed past this login page without valid credentials. All hope was lost, until I saw this within the Android XML resource files:</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo7.png" alt="" /></p>

<p>Wait, seriously? -_-“</p>

<p>Normally resources within the strings.xml file contain text values that are eventually used as part of the Android application. But this, is <strong>HIGHLY</strong> unusual. Wonder if it works…</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo8.png" alt="" /></p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo16.png" alt="" /></p>

<p>YA KNOW? A classic case of a typical mistake done by developers to clear out previous user credentials :)</p>

<p>Now after logging in, the hint provided was a really obvious one. 3 repetitions to the letter S, and in addition to that, we also have prior knowledge that the mobile app utilises the AWS infrastructure. SOOO…. Amazon + 3 ‘S’ characters = Amazon S3?</p>

<p>Anyway, for us to access any authenticated S3 storage buckets, we would need these information:</p>
<ul>
  <li>AWS Access ID</li>
  <li>AWS Access Secret Key</li>
  <li>AWS Region</li>
</ul>

<p>If we look at our Burp Proxy traffic, the following HTTP response was received when we successfully logged into the mobile application:</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo9.png" alt="" /></p>

<p>All you need now is to use the AWS S3 CLI (if you’re on Linux, setting this up is easy as hell) by following these steps:</p>

<p>1) Install AWS CLI (Check this website for more info: https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)
2) Configure an AWS CLI profile with the access ID, key/token and region (I created a separate profile as I too have other AWS keys to manage):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws <span class="nt">--profile</span> stf22 configure
</code></pre></div></div>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo10.png" alt="" /></p>

<p>3) if all configurations are correct and well, run the following command and you should be able to see multiple S3 buckets:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws <span class="nt">--profile</span> stf22 s3 <span class="nb">ls</span>
</code></pre></div></div>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo11.png" alt="" /></p>

<p>HMMMM. Seems like it’s not working T_T. After reading the documentation, it turns out that i also need to include the AWS session token as well. For this you will need to find the ‘credentials’ file and add it yourself:</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo12.png" alt="" /></p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo13.png" alt="" /></p>

<p>After further analysis of listing the buckets, only one contained the flag.</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo14.png" alt="" /></p>

<p>Fetching the flag was relatively easy:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws s3 <span class="nt">--profile</span> stf22 <span class="nb">cp </span>s3://stfflag2/flag2.txt flag2.txt
</code></pre></div></div>

<p>Simply view the contents of the file and voila, you have the flag:</p>

<p><img src="/assets/images/2022-12-10-stacktheflags-2022-topsecretadminpanel/photo15.png" alt="" /></p>
<h1 id="thoughts">Thoughts</h1>

<p>I can totally understand how this challenge is considered to be “easy”, provided that you know about these two concepts:</p>
<ul>
  <li>Android App Analysis (Static and Dynamic)</li>
  <li>Familiarisation with Amazon Web Services and its various cloud services (AWS IAM, S3)</li>
</ul>

<p>I was expecting this challenge to have some form of Dynamic Binary Instrumentation (DBI) stuff like using Frida to perform method overriding, but I guess sometimes the best way to solve it is when the solution is simple and straightforward. No need to be so fancy.</p>

<p>I guess the only thing I can brag about this challenge is that my group was the one that got first blood, but i didn’t take photo evidence of it. UGH!</p>

          </div>
          
          <footer class="post-footer">
            <a href="/" class="back-link">← Back to index</a>
          </footer>
        </article>
      </div>
    </div>
  </main>

  <!-- Right Pane: About Me -->
  <aside class="pane pane-right">
    <div class="pane-header">
      <span class="prompt">~/</span>whoami
    </div>
    <div class="pane-content">
      <div class="about-section">
        <!-- Profile Picture -->
        <div class="profile-picture-container">
          <img src="/assets/images/profile.png" alt="baesenseii" class="profile-picture">
          <!-- Placeholder if image doesn't exist -->
          <div class="profile-placeholder">
            <span class="profile-initials">BS</span>
          </div>
        </div>
        
        <div class="about-content">
          <h2>baesenseii@cyber</h2>
          <p class="tagline">Offensive Security & Infrastructure Automation</p>
          
          <div class="bio">
            <p>Penetration tester, security researcher, and automation enthusiast. Breaking things to understand how they work, then automating the fixes.</p>
            
            <p>Focused on offensive security research, red team operations, and infrastructure automation at scale.</p>
          </div>
          
          <div class="social-links">
            <div class="social-header">$ cat ~/.social</div>
            <a href="https://github.com/baesenseii" target="_blank" class="social-link">
              <span class="icon">→</span> github.com/baesenseii
            </a>
            <a href="https://sg.linkedin.com/in/sayedhamzah" target="_blank" class="social-link">
              <span class="icon">→</span> linkedin.com/in/sayedhamzah
            </a>
          </div>
          
          <!-- Friends Section -->
          <div class="links-section">
            <div class="links-header">$ cat ~/.friends_of_bae</div>
            <div class="links-list">
              <a href="https://blog.0wl.sg" target="_blank" class="link-item">
                <span class="link-icon">›</span>
                <span class="link-text">@0wl - my ctf buddy / korkor / masterr</span>
              </a>
              <a href="https://blog.elmo.sg" target="_blank" class="link-item">
                <span class="link-icon">›</span>
                <span class="link-text">@elma - pwn guru 1</span>
              </a>
              <a href="https://kaligulaarmblessed.github.io/" target="_blank" class="link-item">
                <span class="link-icon">›</span>
                <span class="link-text">@kaligula_armblessed - pwn guru 2</span>
              </a>
              <a href="https://elession.github.io/" target="_blank" class="link-item">
                <span class="link-icon">›</span>
                <span class="link-text">@elession</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>

  
  <script src="/assets/js/main.js"></script>
</body>
</html>
