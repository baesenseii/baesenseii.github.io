<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kernel Exploitation Setup with Vagrant and VSCode</title>
  <meta name="description" content="Preface
As some of you might already know by now, I have been taking quite a fair interest on doing pwn challenges in CTF as part of my goal to improve on my...">
  
  <link rel="stylesheet" href="/assets/css/main.css">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="terminal-container">
  <!-- Left Pane: ls-style post listing -->
  <aside class="pane pane-left">
    <div class="pane-header">
      <span class="prompt">~/posts$</span> ls -la
    </div>
    <div class="pane-subheader">
      <input type="text" id="category-filter" placeholder="filter by category or filename..." autocomplete="off">
    </div>
    <div class="pane-content">
      <div class="ls-output">
        <div class="ls-line ls-header">total 13</div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/old_skool_atkdef_251292cc/" data-categories="projects,attkdef-ctf">
          <div class="ls-row-1">
            <span class="ls-name">251292cc.md</span>
            <span class="ls-size">3241w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Mar 21</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">projects</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item active" data-post="/posts/kernel_expdev_setup_with_vscode_ee35e20e/" data-categories="vr,kernelpwn,pwn">
          <div class="ls-row-1">
            <span class="ls-name">ee35e20e.md</span>
            <span class="ls-size">2958w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Mar 04</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">vr</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/mcrta_review_writeup_3ee1dbfe/" data-categories="certs,mcrta">
          <div class="ls-row-1">
            <span class="ls-name">3ee1dbfe.md</span>
            <span class="ls-size">1210w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Jan 12</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">certs</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/crtp_review_writeup_98ab231c/" data-categories="certs,crtp">
          <div class="ls-row-1">
            <span class="ls-name">98ab231c.md</span>
            <span class="ls-size">1316w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Nov 03</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">certs</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_8_fc50222e/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">fc50222e.md</span>
            <span class="ls-size">2338w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 21</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_7a_fa086321/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">fa086321.md</span>
            <span class="ls-size">1380w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 20</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_6a_f360496c/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">f360496c.md</span>
            <span class="ls-size">1472w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 19</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_5_c8ec6a29/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">c8ec6a29.md</span>
            <span class="ls-size">1758w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 18</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_4_9c752a2b/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">9c752a2b.md</span>
            <span class="ls-size">1086w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 17</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_3_8ab5e6e3/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">8ab5e6e3.md</span>
            <span class="ls-size">675w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 16</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_2_6cc9934c/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">6cc9934c.md</span>
            <span class="ls-size">838w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 15</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/tisc24_challenge_1_471f6270/" data-categories="ctf,tisc2024">
          <div class="ls-row-1">
            <span class="ls-name">471f6270.md</span>
            <span class="ls-size">732w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Oct 14</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
        
        
        
        
        
        <div class="ls-line post-item " data-post="/posts/stacktheflags-2022-topsecretadminpanel_369b9cd7/" data-categories="ctf">
          <div class="ls-row-1">
            <span class="ls-name">369b9cd7.md</span>
            <span class="ls-size">861w</span>
          </div>
          <div class="ls-row-2">
            <span class="ls-timestamp">Dec 10</span>
            <span class="ls-owner">baesenseii</span>
            <span class="ls-group">ctf</span>
          </div>
        </div>
        
      </div>
    </div>
  </aside>

  <!-- Center Pane: Post content -->
  <main class="pane pane-center">
    <div class="pane-header">
      <span class="prompt">~/</span>
      <span id="center-path">Kernel Exploitation Setup with Vagran...</span>
    </div>
    <div class="pane-content">
      <div class="post-viewer active">
        <article class="post-content">
          <header class="post-header">
            <h1>Kernel Exploitation Setup with Vagrant and VSCode</h1>
            <div class="post-meta">
              <span class="post-date">March 04, 2025</span>
              
              <span class="post-categories">
                
                  <span class="category">vr</span>
                
                  <span class="category">kernelpwn</span>
                
                  <span class="category">pwn</span>
                
              </span>
              
            </div>
          </header>
          
          <div class="post-body">
            <h1 id="preface">Preface</h1>
<p>As some of you might already know by now, I have been taking quite a fair interest on doing pwn challenges in CTF as part of my goal to improve on my binary exploitation skills.</p>

<p>Back in Dec 2024, I’ve had the privilege to volunteer as a Teaching Assistant for the Advanced Youth Cyber Exploration Programme (AYCEP) which involved participants from various tertiary institutions and academia (JC/Secondary). More details on the programme can be found here: https://www.csa.gov.sg/our-programmes/talent-and-skills-development/sg-cyber-talent/sg-cyber-youth/advanced-youth-cyber-exploration-programme</p>

<p>Long story short, one of the modules covered in the programme was vulnerability research (in the area of binary and KERNEL exploitation), and by far this module destroyed like 99% of the participants (especially when kernelpwn was introduced). As much as the students were lost, I found it very intriguing to learn and started to deep dive into it more.</p>

<h1 id="kernel-exploitation">Kernel Exploitation</h1>
<h2 id="the-problem">The Problem</h2>

<p>During the programme, the qemu-system tool was used to help emulate kernel environments to run our exploits which were based on vulnerable Linux drivers that were already pre-built into the kernel. The main idea of this exploit is to escalate privileges from a low-privileged user to root privileges based on vulnerabilities identified in the driver (e.g Use-After-Free, Kernel-based Buffer Overflow attacks, etc).</p>

<p>Based on my experience just going through the labs, here are the things that I find it pretty troublesome and annoying to do:
1) The following tools need to be installed on the debugging system:
	- musl-gcc =&gt; for compiling exploits
	- qemu-system =&gt; for kernel environment emulation
	- gdb =&gt; for kernel debugging (you can use pwndbg or even GEF, take your pick)</p>

<p>2) Every single time the exploit code (in C) is changed, it is required to compile the exploit</p>

<p>3) Next, the ‘exploit’ binary has to be placed inside the ‘initramfs.cpio.gz’ file, which contains all the necessary binaries that define the root filesystem when the kernel boots up.</p>

<p>4) As qemu-system has an in-built functionality to launch gdbserver for remote debugging (‘-s’) + pausing the kernel CPU before the remote debugging is established, due to (3), this will mean that i need to keep on rebooting the kernel after a new ‘initramfs.cpio.gz’ file is generated (which will be like, almost all the time whenever there’s a change in the exploit code).</p>

<p>5) Lately, Visual Studio Code has been my go-to editor due to the extensions (was actively creating Docker images for my teaching content in school), but I have been using it extensively for my exploit code (with the C/C++ intellisense capabilities). In addition I used the Integrated Terminal to run qemu-system and gdb, however it is extremely annoying to keep on launching new tabs and writing the commands again.</p>

<p>6) On top of all that, in the event whereby my debugging machine fails, I seriously do not want to do the installation and configuration of the tools again. -_-“</p>
<h2 id="the-solution">The Solution</h2>

<h3 id="the-setup">The Setup</h3>
<p>Do bear in mind that at the time of this documentation, this is all being done on a laptop running Manjaro Linux, along with Vagrant and Visual Studio Code installed. And that is pretty much it to be honest :)</p>

<p>I am sure of those professionals who read this blog will be like “ah this is such a newb setup”, but I am writing this blog post so that others who want to get started on kernel exploitation would be more motivated to think of ways that can help ease the process. :)</p>
<h3 id="the-1337-scripts-sorta">The 1337 scripts (sorta..)</h3>
<p>Now for point 6, this is kind of a given. The best way to do this is to set up a debugging VM machine and then export it to an OVA file. However, in order to grant greater flexibility to customise the debugging VM machine, I would think the best way to do it is to use Vagrant (which has been a godsend for me ever since I used it for implementing my CTF infrastructures).</p>

<p>So here’s the Vagrantfile used to create my customisable debugging VM machine:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/jammy64"
  config.vm.hostname = "pwnvm"

  config.vm.provider "virtualbox" do |vb|
    vb.memory = "4096"
  end
  config.vm.provision "shell", inline: &lt;&lt;-SHELL

  # Add Docker's official GPG key:
sudo apt-get update
sudo apt-get -y install ca-certificates curl net-tools
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release &amp;&amp; echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
sudo apt-get update

# install the necessary tools needed
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin python3-pip gdb vim tmux qemu-system musl-tools

# add the vagrant account to allow access to docker without logging in as root.
sudo usermod -aG docker vagrant

# installing pwntools
sudo pip3 install --upgrade pip
sudo pip3 install pwntools

git clone https://github.com/pwndbg/pwndbg
cd pwndbg
sudo ./setup.sh
echo "source /home/vagrant/pwndbg/gdbinit.py" &gt; /home/vagrant/.gdbinit

  SHELL
end
</code></pre></div></div>

<p>For steps 2,3 and 4, I have taken the liberty to create the following wrapper scripts:</p>
<ul>
  <li>unzip_cpio.sh (only need to be run once) =&gt; Unzips the contents of the initramfs.cpio.gz file and places it in a newly created folder called ‘initramfs’:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/sh
mkdir initramfs
cd initramfs
cp ../initramfs.cpio.gz .
gunzip ./initramfs.cpio.gz
cpio -idm &lt; ./initramfs.cpio
rm initramfs.cpio
</code></pre></div></div>

<ul>
  <li>recompile-exploit-run.sh =&gt; Performs the compilation of the exploit, loading it into the root filesystem folder before compressing it to ‘initramfs.cpio.gz’. In addition, the script will also attempt to emulate the kernel using Qemu with the necessary debugging options (note that as of now my environment has KASLR disabled. Typical kernel pwn environments would provide a run.sh to launch the environment with Qemu, so do adjust it accordingly):</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/sh

musl-gcc -o ./initramfs/exploit ./exploit.c -static

cd initramfs
find . -print0 | cpio -ov --format=newc --null | gzip -9 &gt; ../initramfs.cpio.gz
cd ../

## If you want to enable debugging mode, uncomment this qemu-system code syntax.

# qemu-system-x86_64 -s -S \
#     -kernel ./bzImage \
#     -cpu qemu64,+smep,+smap \
#     -m 4G \
#     -smp 2 \
#     -initrd initramfs.cpio.gz \
#     -append "console=ttyS0 quiet loglevel=3 nokaslr kpti=1" \
#     -monitor /dev/null \
#     -nographic \
#     -no-reboot \

## If you want to disable debugging mode, uncomment this qemu-system code syntax.
qemu-system-x86_64 \
    -kernel ./bzImage \
    -cpu qemu64,+smep,+smap \
    -m 4G \
    -smp 2 \
    -initrd initramfs.cpio.gz \
    -append "console=ttyS0 quiet loglevel=3 nokaslr kpti=1" \
    -monitor /dev/null \
    -nographic \
    -no-reboot \
</code></pre></div></div>

<h3 id="the-secret-vscode-weapon-tasksjson">The Secret VSCode Weapon: tasks.json</h3>

<p>Some of you might already know regarding Visual Studio Code having the Integrated Terminal, which allows users to interface with the Linux terminal without the need to launch the actual Terminal application.  Being the lazy programmer that I am, I started to tinker with VSCode and I discovered this (https://code.visualstudio.com/docs/editor/tasks):</p>

<p><img src="/assets/images/kernelexp101/Pasted image 20250304062808.png" alt="" /></p>

<p>Like every code builder / IDE application, there are bound to be task-related functionalities for programmers to define an automated set of tasks that can be triggered via the click of a button instead of repeatedly typing the commands again and again.</p>

<p>Since all of my kernel development tools reside in the debugger VM via vagrant, I have defined a set of tasks (only for kernel exploitation development) that allows me to run the scripts listed earlier (tasks.json):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> 
	</span><span class="p">[</span><span class="w">
		</span><span class="p">{</span><span class="w">
			</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Compile exploit and launch kernel (Vagrant)"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">&lt;--</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">shell</span><span class="w"> </span><span class="err">here</span><span class="w">
			</span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
				</span><span class="s2">"ssh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\"</span><span class="s2">cd /vagrant; bash ./recompile-exploit-run.sh</span><span class="se">\"</span><span class="s2">"</span><span class="w">
				</span><span class="p">]</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="p">{</span><span class="w">
			</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Connect to remote gdbserver via GDB CLI (Vagrant)"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"args"</span><span class="p">:[</span><span class="s2">"ssh"</span><span class="p">,</span><span class="s2">"-c"</span><span class="p">,</span><span class="s2">"gdb -ex=</span><span class="se">\"</span><span class="s2">tar rem :1234</span><span class="se">\"</span><span class="s2">"</span><span class="p">]</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="p">{</span><span class="w">
			</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Connect to remote gdbserver via GDB CLI with 1 initial breakpoint (Vagrant)"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"args"</span><span class="p">:[</span><span class="s2">"ssh"</span><span class="p">,</span><span class="s2">"-c"</span><span class="p">,</span><span class="s2">"</span><span class="se">\"</span><span class="s2">gdb -ex='tar rem :1234' -ex='b *${input:memory_bp}' -ex=c</span><span class="se">\"</span><span class="s2">"</span><span class="p">]</span><span class="w">
		</span><span class="p">},</span><span class="w">
		</span><span class="p">{</span><span class="w">
			</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unzip initramfs folder (Vagrant)"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">&lt;--</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">shell</span><span class="w"> </span><span class="err">here</span><span class="w">
			</span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
				</span><span class="s2">"ssh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\"</span><span class="s2">cd /vagrant; bash ./unzip_cpio.sh</span><span class="se">\"</span><span class="s2">"</span><span class="w">
				</span><span class="p">]</span><span class="w">
		</span><span class="p">}</span><span class="w">
	</span><span class="p">],</span><span class="w">
	</span><span class="nl">"inputs"</span><span class="p">:</span><span class="w">
	</span><span class="p">[</span><span class="w">
		</span><span class="p">{</span><span class="w">
			</span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enter the address location that you want to set a breakpoint on before proceeding with GDB"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"memory_bp"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"promptString"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
	

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Bear in mind that the Vagrantfile and the scripts mentioned are all located within a single workspace, as shown in the VSCode File Explorer example here:</p>

<p><img src="/assets/images/kernelexp101/Pasted image 20250304072728.png" alt="" /></p>

<p>To initialise the setup, you will need to make sure that:</p>
<ul>
  <li>All your kernel-related files such as the config, bzImage and initramfs.cpio.gz file are located in that same folder</li>
  <li>Run the following command to start up the Vagrant VM
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant up
</code></pre></div>    </div>
  </li>
</ul>

<p>By default, Vagrant maps all the current working directory files as a shared drive within the VM, under the location /vagrant. With that in mind, the various VSCode Tasks defined in tasks.json will work as there is no change with regards to the location of the scripts.</p>
<h2 id="the-result">The Result</h2>
<p>To test out the task, I just simply need to do the following steps (but make sure your Vagrant VM is already up before proceeding):
1) Ensure that the tasks.json file is inside the .vscode folder (refer to the previous screenshot)
2) Press Ctrl+Shift+P to launch the Command Palette. Click on <strong>Tasks: Run Task</strong></p>

<p><img src="/assets/images/kernelexp101/Pasted image 20250304073226.png" alt="" /></p>

<p>3) Navigate to the task <strong>Compile exploit and launch kernel (Vagrant)</strong>. This will result in the Integrated Terminal showing the compilation of the exploit along with the kernel on pause until GDB is attached (as I have set it to debug mode):</p>

<p><img src="/assets/images/kernelexp101/Pasted image 20250304074339.png" alt="" /></p>

<p>4) Repeat Steps (2) and (3), but this time run the task <strong>Connect to remote gdbserver via GDB CLI (Vagrant)</strong>. This will also launch another tab within the Integrated Terminal to load up GDB (for mine it’s pwndbg). Once it’s hooked, just press ‘c’ to continue with the loading of the kernel:</p>

<p><img src="/assets/images/kernelexp101/Pasted image 20250304074425.png" alt="" /></p>

<p>5) Under the Integrated Terminal, you can switch back your Terminal interface to the task ‘Compile exploit and launch kernel (Vagrant)’:</p>

<p><img src="/assets/images/kernelexp101/Pasted image 20250304074610.png" alt="" /></p>

<p><img src="/assets/images/kernelexp101/Pasted image 20250304074721.png" alt="" /></p>

<p>And that’s pretty much it for the setup! Now do bear in mind that all your VS Code tasks are usually performed within the context of your workspace, so you can add on a series of other Tasks that might help you in your day-to-day work. As of now, here’s my list of Tasks that I have defined which proved to be quite useful as I was doing my kernel exploitation work:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">See</span><span class="w"> </span><span class="err">https://go.microsoft.com/fwlink/?LinkId=</span><span class="mi">733558</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">documentation</span><span class="w"> </span><span class="err">about</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">tasks.json</span><span class="w"> </span><span class="err">format</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Compile exploit and launch kernel (Vagrant)"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">&lt;--</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">shell</span><span class="w"> </span><span class="err">here</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"ssh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\"</span><span class="s2">cd /vagrant; bash ./recompile-exploit-run.sh</span><span class="se">\"</span><span class="s2">"</span><span class="w">
            </span><span class="p">]</span><span class="w">
            
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Connect to remote gdbserver via GDB CLI (Vagrant)"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:[</span><span class="s2">"ssh"</span><span class="p">,</span><span class="s2">"-c"</span><span class="p">,</span><span class="s2">"gdb -ex=</span><span class="se">\"</span><span class="s2">tar rem :1234</span><span class="se">\"</span><span class="s2">"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Connect to remote gdbserver via GDB CLI with 1 initial breakpoint (Vagrant)"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:[</span><span class="s2">"ssh"</span><span class="p">,</span><span class="s2">"-c"</span><span class="p">,</span><span class="s2">"</span><span class="se">\"</span><span class="s2">gdb -ex='tar rem :1234' -ex='b *${input:memory_bp}' -ex=c</span><span class="se">\"</span><span class="s2">"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Destroy Vagrant VM"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant destroy -f"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Start up Vagrant VM"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant up"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shut down Vagrant VM"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant halt"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Generate cyclic pattern (Vagrant)"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:[</span><span class="s2">"ssh"</span><span class="p">,</span><span class="s2">"-c"</span><span class="p">,</span><span class="s2">"python3 -c </span><span class="se">\"</span><span class="s2">from pwn import *;print(cyclic(${input:pattern_size}))</span><span class="se">\"</span><span class="s2">"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Get memory offset based on value (Vagrant)"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:[</span><span class="s2">"ssh"</span><span class="p">,</span><span class="s2">"-c"</span><span class="p">,</span><span class="s2">"python3 -c </span><span class="se">\"</span><span class="s2">from pwn import *;print(hex(cyclic_find(${input:memory_offset})))</span><span class="se">\"</span><span class="s2">"</span><span class="p">]</span><span class="w">
            
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unzip initramfs folder (Vagrant)"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">&lt;--</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">shell</span><span class="w"> </span><span class="err">here</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"ssh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\"</span><span class="s2">cd /vagrant; bash ./unzip_cpio.sh</span><span class="se">\"</span><span class="s2">"</span><span class="w">
            </span><span class="p">]</span><span class="w">
            
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Generate kernel ROP gadgets from vmlinux to text file (Vagrant)"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"ssh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\"</span><span class="s2">ROPgadget --binary /vagrant/vmlinux &gt; /vagrant/gadgets.txt</span><span class="se">\"</span><span class="s2">"</span><span class="w">
            </span><span class="p">]</span><span class="w">
            
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Generate userland ROP gadgets from exploit to text file (Vagrant)"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vagrant"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"ssh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"</span><span class="se">\"</span><span class="s2">ROPgadget --binary /vagrant/initramfs/exploit &gt; /vagrant/gadgets-userland.txt</span><span class="se">\"</span><span class="s2">"</span><span class="w">
            </span><span class="p">]</span><span class="w">
            
        </span><span class="p">}</span><span class="w">       
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"inputs"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enter the pattern size of your cyclic string."</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pattern_size"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"promptString"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enter the offset value of the memory address you see in the RIP register"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"memory_offset"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"promptString"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enter the address location that you want to set a breakpoint on before proceeding with GDB"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"memory_bp"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"promptString"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h1 id="thoughts">Thoughts</h1>
<p>It’s funny that when i started this project, the main intention was more of to automate the commands/actions that i had to normally do while developing the exploit in Visual Studio Code. But now, come to think of it, this project could also be easily extended to development for the usual userland pwn activities (normal buffer overflow exploits, etc). Since the debugger environment is also on a VM (and it’s a Vagrantfile), this also means that there is a possibility to develop a standard baseline of exploit development tools for anyone who wants to dive into the world of pwn and kernelpwn. And all you need is just Visual Studio Code and Vagrant :)</p>

<p>I might just create a simple GitHub repository with all the necessary folder structures and the tasks defined so that anyone can clone this. But till then, hope you guys enjoy this simple yet amazing setup (i’m loving it anw):</p>

<p><img src="/assets/images/kernelexp101/Pasted image 20250304075521.png" alt="" /></p>

          </div>
          
          <footer class="post-footer">
            <a href="/" class="back-link">← Back to index</a>
          </footer>
        </article>
      </div>
    </div>
  </main>

  <!-- Right Pane: About Me -->
  <aside class="pane pane-right">
    <div class="pane-header">
      <span class="prompt">~/</span>whoami
    </div>
    <div class="pane-content">
      <div class="about-section">
        <!-- Profile Picture -->
        <div class="profile-picture-container">
          <img src="/assets/images/profile.png" alt="baesenseii" class="profile-picture">
          <!-- Placeholder if image doesn't exist -->
          <div class="profile-placeholder">
            <span class="profile-initials">BS</span>
          </div>
        </div>
        
        <div class="about-content">
          <h2>baesenseii@cyber</h2>
          <p class="tagline">Offensive Security & Infrastructure Automation</p>
          
          <div class="bio">
            <p>Penetration tester, security researcher, and automation enthusiast. Breaking things to understand how they work, then automating the fixes.</p>
            
            <p>Focused on offensive security research, red team operations, and infrastructure automation at scale.</p>
          </div>
          
          <div class="social-links">
            <div class="social-header">$ cat ~/.social</div>
            <a href="https://github.com/baesenseii" target="_blank" class="social-link">
              <span class="icon">→</span> github.com/baesenseii
            </a>
            <a href="https://sg.linkedin.com/in/sayedhamzah" target="_blank" class="social-link">
              <span class="icon">→</span> linkedin.com/in/sayedhamzah
            </a>
          </div>
          
          <!-- Friends Section -->
          <div class="links-section">
            <div class="links-header">$ cat ~/.friends_of_bae</div>
            <div class="links-list">
              <a href="https://blog.0wl.sg" target="_blank" class="link-item">
                <span class="link-icon">›</span>
                <span class="link-text">@0wl - my ctf buddy / korkor / masterr</span>
              </a>
              <a href="https://blog.elmo.sg" target="_blank" class="link-item">
                <span class="link-icon">›</span>
                <span class="link-text">@elma - pwn guru 1</span>
              </a>
              <a href="https://kaligulaarmblessed.github.io/" target="_blank" class="link-item">
                <span class="link-icon">›</span>
                <span class="link-text">@kaligula_armblessed - pwn guru 2</span>
              </a>
              <a href="https://elession.github.io/" target="_blank" class="link-item">
                <span class="link-icon">›</span>
                <span class="link-text">@elession</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>

  
  <script src="/assets/js/main.js"></script>
</body>
</html>
